<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <title>Kam vede Dependency injection?</title>

  <!-- Required stylesheet -->
  <link rel="stylesheet" media="screen" href="core/deck.core.css">

  <!-- Extension CSS files go here. Remove or add as needed. -->
  <link rel="stylesheet" media="screen" href="extensions/goto/deck.goto.css">
  <link rel="stylesheet" media="screen" href="extensions/menu/deck.menu.css">
  <link rel="stylesheet" media="screen" href="extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" media="screen" href="extensions/status/deck.status.css">
  <link rel="stylesheet" media="screen" href="extensions/scale/deck.scale.css">

  <!-- Style theme. More available in /themes/style/ or create your own. -->
  <link rel="stylesheet" media="screen" href="themes/style/web-2.0.css">

  <!-- Transition theme. More available in /themes/transition/ or create your own. -->
  <link rel="stylesheet" media="screen" href="themes/transition/horizontal-slide.css">

  <!-- Basic black and white print styles -->
  <link rel="stylesheet" media="print" href="core/print.css">

  <!-- Required Modernizr file -->
  <script src="modernizr.custom.js"></script>
</head>
<body>
  <div class="deck-container">

    <!-- Begin slides. Just make elements with a class of slide. -->

    <section class="slide">
      <h2>Kam vede Dependency Injection</h2>
    </section>

    <section class="slide">
        <h2>Příklad - oceňování hovorů</h2>

        <pre><code>
        # Durian-Rate.pl
        ...
        my $processor = Durian::Rate::Processor->new(;
        $processor->rate_calls();

        # Durian/Rate/Processor.pm
        package Durian::Rate::Processor;

        sub rate_calls {
            my $storage = ...
            my $call_it = $this->get_calls();
            while( my $call = $call_it->()){
                $this-
            }
        }
        
        </code></pre>
    </section>

    <section class="slide">
        <pre><code>
        # Durian-Rate.pl

        ...
        my $storage = DBIx::Class::Storage::DBI->connect('dsn:...', ...);
        my $engine  = Durian::Rate::Engine->new(
            dbh => $storage->dbh
        );
        my $processor = Durian::Rate::Processor->new(
            engine => $engine,
            storage => $storage,
        );
        $processor->rate_calls();
        </code></pre>
    </section>

    <section class="slide">

    <h2>Dependency injection</h2>

    <blockquote>
    Vkládání závislostí (anglicky Dependency injection (DI)) je v objektově orientovaném programování technika pro vkládání závislostí mezi jednotlivými komponentami programu tak, aby jedna komponenta mohla používat druhou, aniž by na ni měla v době sestavování programu referenci.

<footer>— <cite><a title="Česká Wikipedie" href="https://cs.wikipedia.org/wiki/Vkl%C3%A1d%C3%A1n%C3%AD_z%C3%A1vislost%C3%AD">Vkládání závislostí - Česká Wikipedie</a></cite></footer></blockquote>


    </section>

    <section class="slide">
        <h2>Komponenty aplikace</h2>

        <ul>
            <li>Objekty (instance)</li>
            <li>Hodnoty (např. z konfigurace)</li>
            <li>Uzávěry (PSGI, middleware nejen Plack,
                jednoduché objekty, např. CLI
            )</li>
            <li>Konstruované třídy (např. aplikace Catalyst)</li>
        </ul>

        Místo konstrukce - skripty, PSGI, top level 

        Top level komponenty

        "Ruční" sestavení v místě použití - pracné.
        
        Použijeme knihovnu - např. Bread::Board

        Idea:


        Připojení k db
        Připojení k externím systémům (REST, SOAP, ...)
        PSGI aplikace, middlewaree, ...
        Konfigurace, ...
        Webové aplikace 
    </section>

    <section class="slide">
        
    <h2>Adresář komponent</h2>

    <ul>
        <li>Všechny komponenty mají jména (hierarchická)</li>
        <li>Adresář obsahuje komponenty všech běhových prostředí</li>
        <li>Rozhraní závislé na frameworku</li>
        <li>Implementace - generátory (služby)</li>
        <li>Struktura (jména) a granularita závisí na autorech</li>
        <li>Adresář zpřístupníme jako objekt
            <pre><code>use Durian::IOC;
my $adresar = Durian::IOC->root;
my $processor = $adresar->resolve(service => 'Rate/processor');</code></pre>
        </li>
        <li>Nebo jako funkci, vracející komponentu pro zadané jméno
            <pre><code>use Durian::IOC qw(resolve);
my $processor = resolve('Rate/processor');</code></pre>
</li>
</li>
    </ul>
    <!-- Dáme všem komponentám v aplikaci jména a centrálně mezi nimi definujeme závislosti.
    Adresář komponent zpřístupníme jako funkci (metodu) apod.
    adresář komponent nezávislý na tom, kde komponenta poběží
    hierarchická jmé

     každý skript si pro svou práci vytáhne jednu nebo více top level komponent
    a provede s nimi nějakou činnost -->

    </section>

    <section class="slide">
    <h2>Adresář komponent - příklad použití</h2>

    <pre><code>
    # durian-rate.pl
    use Durian::IOC;

    # vrátí adresář komponent
    my $root = Durian::IOC->root;
    my $rate_processor = $root->resolve(service => 'Rate/Processor');
    $rate_processor->rate_calls();
    </code></pre>

    <pre><code>
    # durian-rate.pl
    use Durian::IOC qw(resolve);

    my $rate_processor = resolve('Rate/Processor');
    $rate_processor->rate_calls();
    </code></pre>
    </section>

    


    <section class="slide">
      <h2>Here</h2>
      <pre><code>
package MY::SOAPClient;
use Moose;

has config => ( is => 'ro', lazy => 1, builder => '_build_config' );

has proxy_url => (
    is      => 'ro',
    lazy    => 1,
    default => sub {
        my $this = shift;
        my $proxy = $this->config->{proxy}
            or die "The configuration is missing the proxy"; 
        return $proxy
    }
);

sub _build_config {
    my $this = shift;
    my $file = najdi_konfiguraci_podle_tridy($this);
    return natahni_konfiguraci($file);
}

sub BUILD {
    my $this = $shift;

    # lazy, ale ne tak moc
    $this->proxy_url;
}
      </code></pre>
    </section>

    <section class="slide">
        <h2>Důsledky uplatňování principu</h2>

        <ul>
            <li>Zjednodušení struktury tříd (instance vs třídy)</li>
            <li>Posouvání aplikační logiky vzhůru</li>
            <li>Odstraňování chytrosti</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Odbočka</h2>

        <p>Je následující kód sexy?</p>

        <pre><code>
        $logger->debug( "Options are @{[Dumper($options)]}" );
        </code></pre>

        <pre><code>
        my $the_options = Dumper($options);
        $logger->debug( "Options are $the_options" );
        </code></pre>

    </section>

    <section class="slide">
        <h2>Posouvání aplikační logiky "vzhůru"</h2>

        <pre>
        <code>
        my $request = $schema->resultset('Request')->find($request_id);
        $request->run_worklow();
        </code>
        </pre>
   

        <ul>
            <li>Používání value objektů</li>
            <li>Používání "statických" objektů (mailer, processor, rating_engine)</li>
            <li>Mail se sám neodešle, požadavek nezpracuje, hovor neocení</li>
        </ul>

        <p>OOP antipattern?</p>

    </section>
    <!-- End slides. -->

    <!-- Begin extension snippets. Add or remove as needed. -->

    <!-- deck.navigation snippet -->
    <div aria-role="navigation">
      <a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
      <a href="#" class="deck-next-link" title="Next">&#8594;</a>
    </div>

    <!-- deck.status snippet -->
    <p class="deck-status" aria-role="status">
      <span class="deck-status-current"></span>
      /
      <span class="deck-status-total"></span>
    </p>

    <!-- deck.goto snippet -->
    <form action="." method="get" class="goto-form">
      <label for="goto-slide">Go to slide:</label>
      <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
      <datalist id="goto-datalist"></datalist>
      <input type="submit" value="Go">
    </form>

    <!-- End extension snippets. -->
  </div>

<!-- Required JS files. -->
<script src="jquery.min.js"></script>
<script src="core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/scale/deck.scale.js"></script>

<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
  $(function() {
    $.deck('.slide');
  });
</script>
</body>
<!--
vim: 
# vim: expandtab:shiftwidth=4:tabstop=4:softtabstop=0
-->
</html>
